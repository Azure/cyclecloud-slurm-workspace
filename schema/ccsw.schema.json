{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "CycleCloud Slurm Workspace",
    "type": "object",
    "properties": {
        "resourceLocation": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "string"
                }
            },
            "required": [
                "value"
            ]
        },
        "adminUsername": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "string"
                }
            },
            "required": [
                "value"
            ]
        },
        "adminPassword": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "string"
                }
            },
            "required": [
                "value"
            ]
        },
        "useEnteredKey": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "boolean"
                }
            },
            "required": [
                "value"
            ]
        },
        "adminSshPublicKey": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "string",
                    "pattern": "^ssh-rsa AAAAB3NzaC1yc2[0-9A-Za-z+/]+[=]{0,3}(\\s.*)?$"
                }
            },
            "required": [
                "value"
            ]
        },
        "useStoredKey": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "boolean"
                }
            },
            "required": [
                "value"
            ]
        },
        "storedKey": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "object",
                    "properties": {
                        "id": {
                            "type": "string"
                        },
                        "location": {
                            "type": "string"
                        },
                        "name": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "id",
                        "location",
                        "name"
                    ]
                }
            },
            "required": [
                "value"
            ]
        },
        "ccVMSize": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "string"
                }
            },
            "required": [
                "value"
            ]
        },
        "databaseAdminPassword": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "string",
                    "const": ""
                }
            },
            "required": [
                "value"
            ]
        },
        "ccswConfig": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "object",
                    "properties": {
                        "resource_group": {
                            "type": "string"
                        },
                        "rgLocation": {
                            "type": "string"
                        },
                        "filesystem": {
                            "type": "object",
                            "properties": {
                                "shared": {
                                    "type": "object",
                                    "properties": {
                                        "create_new": {
                                            "type": "boolean"
                                        },
                                        "config": {
                                            "type": "object",
                                            "properties": {
                                                "filertype": {
                                                    "type": "string",
                                                    "enum": [
                                                        "nfs",
                                                        "anf"
                                                    ]
                                                },
                                                "nfs_capacity_in_gb": {
                                                    "type": "integer"
                                                },
                                                "anf_service_tier": {
                                                    "type": "string"
                                                },
                                                "anf_capacity_in_bytes": {
                                                    "type": "integer"
                                                },
                                                "ip_address": {
                                                    "type": "string"
                                                },
                                                "export_path": {
                                                    "type": "string"
                                                },
                                                "mount_options": {
                                                    "type": "string"
                                                }
                                            },
                                            "required": [
                                                "filertype",
                                                "nfs_capacity_in_gb",
                                                "anf_service_tier",
                                                "anf_capacity_in_bytes",
                                                "ip_address",
                                                "export_path",
                                                "mount_options"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "create_new",
                                        "config"
                                    ],
                                    "additionalProperties": false
                                },
                                "additional": {
                                    "type": "object",
                                    "properties": {
                                        "additional_filer": {
                                            "type": "boolean"
                                        },
                                        "create_new": {
                                            "type": "boolean"
                                        },
                                        "config": {
                                            "type": "object",
                                            "properties": {
                                                "filertype": {
                                                    "type": "string"
                                                },
                                                "anf_service_tier": {
                                                    "type": "string"
                                                },
                                                "anf_capacity_in_bytes": {
                                                    "type": "integer"
                                                },
                                                "lustre_tier": {
                                                    "type": "string"
                                                },
                                                "lustre_capacity_in_tib": {
                                                    "type": "integer"
                                                },
                                                "ip_address": {
                                                    "type": "string"
                                                },
                                                "mount_path": {
                                                    "type": "string"
                                                },
                                                "export_path": {
                                                    "type": "string"
                                                },
                                                "mount_options": {
                                                    "type": "string"
                                                }
                                            },
                                            "required": [
                                                "filertype",
                                                "anf_service_tier",
                                                "lustre_tier",
                                                "lustre_capacity_in_tib",
                                                "ip_address",
                                                "mount_path",
                                                "export_path",
                                                "mount_options"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "additional_filer",
                                        "create_new",
                                        "config"
                                    ]
                                }
                            },
                            "required": [
                                "shared",
                                "additional"
                            ],
                            "additionalProperties": false,
                            "allOf": [
                                {
                                    "if": {
                                        "properties": {
                                            "shared": {
                                                "properties": {
                                                    "config": {
                                                        "properties": {
                                                            "filertype": {
                                                                "const": "nfs"
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "then": {
                                        "properties": {
                                            "shared": {
                                                "properties": {
                                                    "config": {
                                                        "properties": {
                                                            "anf_service_tier": {
                                                                "const": ""
                                                            },
                                                            "anf_capacity_in_bytes": {
                                                                "const": -1
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "if": {
                                            "properties": {
                                                "shared": {
                                                    "properties": {
                                                        "create_new": {
                                                            "const": true
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "then": {
                                            "properties": {
                                                "shared": {
                                                    "properties": {
                                                        "config": {
                                                            "properties": {
                                                                "nfs_capacity_in_gb": {
                                                                    "mininum": 100,
                                                                    "maximum": 102400
                                                                },
                                                                "ip_address": {
                                                                    "const": ""
                                                                },
                                                                "export_path": {
                                                                    "const": ""
                                                                },
                                                                "mount_options": {
                                                                    "const": ""
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "else": {
                                            "properties": {
                                                "shared": {
                                                    "properties": {
                                                        "config": {
                                                            "properties": {
                                                                "nfs_capacity_in_gb": {
                                                                    "const": -1
                                                                },
                                                                "ip_address": {
                                                                    "pattern": "^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$"
                                                                },
                                                                "export_path": {
                                                                    "minLength": 1
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "else": {
                                        "if": {
                                            "properties": {
                                                "shared": {
                                                    "properties": {
                                                        "create_new": {
                                                            "const": true
                                                        },
                                                        "config": {
                                                            "properties": {
                                                                "filertype": {
                                                                    "const": "anf"
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "then": {
                                            "properties": {
                                                "shared": {
                                                    "properties": {
                                                        "config": {
                                                            "properties": {
                                                                "anf_service_tier": {
                                                                    "enum": [
                                                                        "Standard",
                                                                        "Premium",
                                                                        "Ultra"
                                                                    ]
                                                                },
                                                                "anf_capacity_in_bytes": {
                                                                    "minimum": 1,
                                                                    "maximum": 1000
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "else": false
                                    }
                                },
                                {
                                    "if": {
                                        "properties": {
                                            "additional": {
                                                "properties": {
                                                    "additional_filer": {
                                                        "const": false
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "then": {
                                        "properties": {
                                            "additional": {
                                                "properties": {
                                                    "create_new": {
                                                        "const": false
                                                    },
                                                    "config": {
                                                        "properties": {
                                                            "filertype": {
                                                                "const": ""
                                                            },
                                                            "anf_service_tier": {
                                                                "const": ""
                                                            },
                                                            "anf_capacity_in_bytes": {
                                                                "const": -1
                                                            },
                                                            "lustre_tier": {
                                                                "const": ""
                                                            },
                                                            "lustre_capacity_in_tib": {
                                                                "const": -1
                                                            },
                                                            "ip_address": {
                                                                "const": ""
                                                            },
                                                            "mount_path": {
                                                                "const": ""
                                                            },
                                                            "export_path": {
                                                                "const": ""
                                                            },
                                                            "mount_options": {
                                                                "const": ""
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    },
                                    "else": {
                                        "properties": {
                                            "additional": {
                                                "properties": {
                                                    "config": {
                                                        "properties": {
                                                            "mount_path": {
                                                                "minLength": 1
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "allOf": [
                                            {
                                                "if": {
                                                    "properties": {
                                                        "additional": {
                                                            "properties": {
                                                                "create_new": {
                                                                    "const": true
                                                                }
                                                            }
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "properties": {
                                                        "additional": {
                                                            "properties": {
                                                                "config": {
                                                                    "properties": {
                                                                        "filertype": {
                                                                            "enum": [
                                                                                "anf",
                                                                                "aml"
                                                                            ]
                                                                        },
                                                                        "ip_address": {
                                                                            "const": ""
                                                                        },
                                                                        "mount_options": {
                                                                            "const": ""
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "if": {
                                                        "properties": {
                                                            "additional": {
                                                                "properties": {
                                                                    "config": {
                                                                        "properties": {
                                                                            "filertype": {
                                                                                "const": "anf"
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "then": {
                                                        "properties": {
                                                            "additional": {
                                                                "properties": {
                                                                    "config": {
                                                                        "properties": {
                                                                            "anf_service_tier": {
                                                                                "enum": [
                                                                                    "Standard",
                                                                                    "Premium",
                                                                                    "Ultra"
                                                                                ]
                                                                            },
                                                                            "anf_capacity_in_bytes": {
                                                                                "minimum": 1,
                                                                                "maximum": 1000
                                                                            },
                                                                            "lustre_tier": {
                                                                                "const": ""
                                                                            },
                                                                            "lustre_capacity_in_tib": {
                                                                                "const": -1
                                                                            },
                                                                            "export_path": {
                                                                                "minLength": 1
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "else": {
                                                        "if": {
                                                            "properties": {
                                                                "additional": {
                                                                    "properties": {
                                                                        "config": {
                                                                            "properties": {
                                                                                "filertype": {
                                                                                    "const": "anf"
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "then": {
                                                            "properties": {
                                                                "additional": {
                                                                    "properties": {
                                                                        "config": {
                                                                            "properties": {
                                                                                "anf_service_tier": {
                                                                                    "const": ""
                                                                                },
                                                                                "anf_capacity_in_bytes": {
                                                                                    "const": -1
                                                                                },
                                                                                "lustre_tier": {
                                                                                    "enum": [
                                                                                        "AMLFS-Durable-Premium-40",
                                                                                        "AMLFS-Durable-Premium-125",
                                                                                        "AMLFS-Durable-Premium-250",
                                                                                        "AMLFS-Durable-Premium-500"
                                                                                    ]
                                                                                },
                                                                                "lustre_capacity_in_tib": {
                                                                                    "minimum": 4,
                                                                                    "maximum": 768
                                                                                },
                                                                                "export_path": {
                                                                                    "const": ""
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        "else": false
                                                    }
                                                },
                                                "else": {
                                                    "properties": {
                                                        "additional": {
                                                            "properties": {
                                                                "config": {
                                                                    "properties": {
                                                                        "filertype": {
                                                                            "enum": [
                                                                                "nfs",
                                                                                "aml"
                                                                            ]
                                                                        },
                                                                        "ip_address": {
                                                                            "pattern": "^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$"
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "if": {
                                                        "properties": {
                                                            "additional": {
                                                                "properties": {
                                                                    "filertype": {
                                                                        "const": "nfs"
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "then": {
                                                        "properties": {
                                                            "additional": {
                                                                "properties": {
                                                                    "export_path": {
                                                                        "minLength": 1
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    },
                                                    "else": {
                                                        "properties": {
                                                            "additional": {
                                                                "properties": {
                                                                    "export_path": {
                                                                        "const": ""
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        "network": {
                            "type": "object",
                            "properties": {
                                "vnet": {
                                    "type": "object",
                                    "properties": {
                                        "create": {
                                            "type": "boolean"
                                        },
                                        "name": {
                                            "type": "string"
                                        },
                                        "address_space": {
                                            "type": "string"
                                        },
                                        "id": {
                                            "type": "string"
                                        },
                                        "subnets": {
                                            "type": "object",
                                            "properties": {
                                                "cyclecloudSubnet": {
                                                    "type": "string"
                                                },
                                                "computeSubnet": {
                                                    "type": "string"
                                                },
                                                "filerSubnet1": {
                                                    "type": "string"
                                                },
                                                "filerSubnet2": {
                                                    "type": "string"
                                                },
                                                "bastionSubnet": {
                                                    "type": "string"
                                                }
                                            },
                                            "required": [
                                                "cyclecloudSubnet",
                                                "computeSubnet",
                                                "bastionSubnet"
                                            ]
                                        },
                                        "bastion": {
                                            "type": "boolean"
                                        },
                                        "create_natgateway": {
                                            "type": "boolean"
                                        },
                                        "peering": {
                                            "type": "object",
                                            "properties": {
                                                "enabled": {
                                                    "type": "boolean"
                                                },
                                                "vnet": {
                                                    "type": [
                                                        "string",
                                                        "object"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "enabled",
                                                "vnet"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "create",
                                        "name",
                                        "address_space",
                                        "id",
                                        "subnets",
                                        "bastion",
                                        "create_natgateway",
                                        "peering"
                                    ],
                                    "additionalProperties": false
                                }
                            },
                            "required": [
                                "vnet"
                            ],
                            "additionalProperties": false,
                            "if": {
                                "properties": {
                                    "vnet": {
                                        "properties": {
                                            "create": {
                                                "const": true
                                            }
                                        }
                                    }
                                }
                            },
                            "then": {
                                "properties": {
                                    "vnet": {
                                        "properties": {
                                            "address_space": {
                                                "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}($|/(20|21|22|23|24))$"
                                            },
                                            "id": {
                                                "const": ""
                                            },
                                            "peering": {
                                                "if": {
                                                    "properties": {
                                                        "enabled": {
                                                            "const": true
                                                        }
                                                    }
                                                },
                                                "then": {
                                                    "properties": {
                                                        "vnet": {
                                                            "type": "object",
                                                            "properties": {
                                                                "id": {
                                                                    "type": "string",
                                                                    "pattern": "^/subscriptions/[^/]+/resourceGroups/[^/]+/providers/Microsoft\\.Network/virtualNetworks/[^/]+$"
                                                                },
                                                                "location": {
                                                                    "type": "string"
                                                                },
                                                                "name": {
                                                                    "type": "string"
                                                                }
                                                            },
                                                            "required": [
                                                                "id",
                                                                "location",
                                                                "name"
                                                            ]
                                                        }
                                                    }
                                                },
                                                "else": {
                                                    "properties": {
                                                        "vnet": {
                                                            "type": "string",
                                                            "const": ""
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "if": {
                                            "properties": {
                                                "bastion": {
                                                    "const": true
                                                }
                                            }
                                        },
                                        "then": {
                                            "properties": {
                                                "subnets": {
                                                    "properties": {
                                                        "bastionSubnet": {
                                                            "const": "AzureBastionSubnet"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "else": {
                                            "properties": {
                                                "subnets": {
                                                    "properties": {
                                                        "bastionSubnet": {
                                                            "const": ""
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "else": {
                                "properties": {
                                    "vnet": {
                                        "properties": {
                                            "address_space": {
                                                "cosnt": ""
                                            },
                                            "id": {
                                                "pattern": "^/subscriptions/[^/]+/resourceGroups/[^/]+/providers/Microsoft\\.Network/virtualNetworks/[^/]+$"
                                            },
                                            "bastion": {
                                                "const": false
                                            },
                                            "create_natgateway": {
                                                "const": false
                                            },
                                            "peering": {
                                                "properties": {
                                                    "enabled": {
                                                        "const": false
                                                    },
                                                    "vnet": {
                                                        "const": ""
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "slurm_settings": {
                            "type": "object",
                            "properties": {
                                "scheduler_node": {
                                    "properties": {
                                        "schedulerVMSize": {
                                            "type": "string"
                                        },
                                        "schedulerImage": {
                                            "type": "string"
                                        },
                                        "slurmVersion": {
                                            "type": "string"
                                        },
                                        "canUseSlurmHA": {
                                            "type": "boolean"
                                        },
                                        "slurmAccounting": {
                                            "type": "boolean"
                                        }
                                    },
                                    "required": [
                                        "schedulerVMSize",
                                        "schedulerImage",
                                        "slurmVersion"
                                    ]
                                },
                                "login_nodes": {
                                    "properties": {
                                        "loginVMSize": {
                                            "type": "string"
                                        },
                                        "loginImage": {
                                            "type": "string"
                                        },
                                        "initialNodes": {
                                            "type": "integer",
                                            "minimum": 0,
                                            "maximum": 1000
                                        },
                                        "maxNodes": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 1000
                                        }
                                    },
                                    "required": [
                                        "loginVMSize",
                                        "loginImage",
                                        "initialNodes",
                                        "maxNodes"
                                    ]
                                }
                            },
                            "required": [
                                "scheduler_node",
                                "login_nodes"
                            ]
                        },
                        "partition_settings": {
                            "type": "object",
                            "properties": {
                                "health_check": {
                                    "type": "boolean"
                                },
                                "htc": {
                                    "type": "object",
                                    "properties": {
                                        "htcVMSize": {
                                            "type": "string"
                                        },
                                        "maxNodes": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 1000
                                        },
                                        "image": {
                                            "type": "string"
                                        },
                                        "use_spot": {
                                            "type": "boolean"
                                        }
                                    },
                                    "required": [
                                        "htcVMSize",
                                        "maxNodes",
                                        "image",
                                        "use_spot"
                                    ],
                                    "additionalProperties": false
                                },
                                "hpc": {
                                    "type": "object",
                                    "properties": {
                                        "hpcVMSize": {
                                            "type": "string"
                                        },
                                        "maxNodes": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 1000
                                        },
                                        "image": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "hpcVMSize",
                                        "maxNodes",
                                        "image"
                                    ],
                                    "additionalProperties": false
                                },
                                "gpu": {
                                    "type": "object",
                                    "properties": {
                                        "gpuVMSize": {
                                            "type": "string"
                                        },
                                        "maxNodes": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 1000
                                        },
                                        "image": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "gpuVMSize",
                                        "maxNodes",
                                        "image"
                                    ],
                                    "additionalProperties": false
                                }
                            },
                            "required": [
                                "health_check",
                                "htc",
                                "hpc",
                                "gpu"
                            ],
                            "additionalProperties": false
                        },
                        "tags": {
                            "type": "object"
                        }
                    },
                    "required": [
                        "resource_group",
                        "rgLocation",
                        "filesystem",
                        "network",
                        "slurm_settings",
                        "partition_settings",
                        "tags"
                    ]
                }
            },
            "required": [
                "value"
            ]
        },
        "trash_for_arm_ttk": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "object"
                }
            },
            "required": [
                "value"
            ]
        }
    },
    "required": [
        "resourceLocation",
        "adminUsername",
        "adminPassword",
        "useEnteredKey",
        "useStoredKey",
        "ccVMSize",
        "databaseAdminPassword",
        "ccswConfig",
        "trash_for_arm_ttk"
    ],
    "additionalProperties": false,
    "allOf": [
        {
            "if": {
                "properties": {
                    "useEnteredKey": {
                        "properties": {
                            "value": {
                                "const": true
                            }
                        }
                    }
                }
            },
            "then": {
                "properties": {
                    "useStoredKey": {
                        "properties": {
                            "value": {
                                "const": false
                            }
                        }
                    }
                }
            },
            "else": {
                "properties": {
                    "useStoredKey": {
                        "properties": {
                            "value": {
                                "const": true
                            }
                        }
                    }
                }
            }
        },
        {
            "if": {
                "properties": {
                    "useEnteredKey": {
                        "properties": {
                            "value": {
                                "const": true
                            }
                        }
                    }
                }
            },
            "then": {
                "required": [
                    "adminSshPublicKey"
                ]
            },
            "else": {
                "not": {
                    "required": [
                        "adminSshPublicKey"
                    ]
                }
            }
        },
        {
            "if": {
                "properties": {
                    "useStoredKey": {
                        "properties": {
                            "value": {
                                "const": true
                            }
                        }
                    }
                }
            },
            "then": {
                "required": [
                    "storedKey"
                ]
            },
            "else": {
                "not": {
                    "required": [
                        "storedKey"
                    ]
                }
            }
        }
    ]
}